<!DOCTYPE html>

<head>
    <meta charset="UTF-8" />
    <title>Cadastro - Control Block</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="./node_modules/sweetalert2/dist/sweetalert2.min.css">

    <!-- CSS PERSONAL -->
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
    <!-- Barra horizontal de navegação -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">

        <div class="container">
                <div class="logo">
                        <img src="favicon1.png">
                      </div>

            <a class="navbar-brand h1 mb-0" href="../Site Institucional/index.html">Control Block</a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSite">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Itens do menu -->
            <div class="collapse navbar-collapse" id="navbarSite">

                <ul class="navbar-nav mr-auto">

                    <li class="nav-item">
                        <a href="../Site Institucional/index.html#empresa" class="nav-link">Empresa</a>
                    </li>
                    <li class="nav-item">
                        <a href="../Site Institucional/index.html#produto" class="nav-link">Produto</a>
                    </li>
                </ul>

                <!-- Botões de login e cadastro -->
                <form class="form-inline">
                    <a href="../Tela de cadastro/login.html"><button type="button" id="login1"
                            class="btn btn-outline-primary mr-2">Login</button></a>
                    <a href="../Tela de cadastro/cadastro.html"><button type="button" id="cadastro1"
                            class="btn btn-outline-success">Cadastrar</button></a>
                </form>

            </div>

        </div>

    </nav>
    <div class="container my-3">
        <div class="content">


            <!--FORMULÁRIO DE CADASTRO-->
            <div id="cadastro" class="border border-success ">
                <form id="form_cadastro" method="post" action="">
                    <h1>Cadastro</h1>

                    <p>
                        <label for="nome_completo">Informe seu nome completo</label>
                        <input id="nome_completo" class="border border-success" name="nome_completo" required="required" type="text" placeholder="Nome Completo " />
                    </p>

                    <p>
                        <label for="nome_usuario">Escolha o nome de usuário</label>
                        <input id="nome_usuario" class="border border-success" name="nome_usuario" required="required" type="text" placeholder="Usuário" />
                    </p>

                    <p>
                        <label for="email_cad">Informe seu e-mail</label>
                        <input id="email_cad" name="email_cad" required="required" class="border border-success" type="email" placeholder="contato@servidor.com" />
                    </p>

                    <p>
                        <label for="senha_cad">Informe uma senha</label>
                        <input id="senha_cad" name="senha_cad" required="required" class="border border-success" type="password" placeholder="*********" />
                    </p>

                    <p>
                        <button type="button" onclick="registrar()" class="btn btn-lg btn-success btn-block">Cadastrar</button>
                    </p>

                    <p class="link">
                        Já tem conta?
                        <a href="./login.html"><button type="button" class="btn btn-primary">Ir para Login</button></a>
                    </p>
                </form>
            </div>
        </div>
    </div>
    <script src="sweetalert2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
</body>

</html>
<script>
    function entrar() {

        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000
        });

        if (nome_login.value == "" && senha_login.value != "") {
            Toast.fire({
                type: 'error',
                title: 'Usuário não informado!'
            });
        } else if (nome_login.value != "" && senha_login.value == "") {
            Toast.fire({
                type: 'error',
                title: 'Senha não informada!'
            });
        } else if (nome_login.value == "" && senha_login.value == "") {
            Toast.fire({
                type: 'error',
                title: 'Usuário e senha não informada!'
            });
        } else {

            var formulario = new URLSearchParams(new FormData(form_login));
            
            Swal.fire({
                title: 'Carregando...',
                text: 'Verificando informações no Banco de Dados!',
                imageUrl: 'aguarde.gif',
                showConfirmButton: false
            });

            fetch("../usuarios/entrar", {
                method: "POST",
                body: formulario
            }).then(function (response) {

                if (response.ok == true) {
                    response.json().then(resposta => {
                        if (resposta.ok == false) {
                            Swal.fire('Erro no login', 'Tente novamente', 'error');
                        } else {

                            if (resposta[0].email == undefined) {
                                Toast.fire({
                                    type: 'success',
                                    title: 'Login efetuado com sucesso!'
                                }).then(function () {
                                    console.log(JSON.stringify(resposta));
                                    sessionStorage.setItem('qtdemail', resposta.length);
                                    for (i = 0; i < resposta.length; i++) {
                                        sessionStorage.setItem(`email_${i + 1}`, JSON.stringify(resposta[i]));
                                    }
                                    sessionStorage.id = resposta[0].id;
                                    sessionStorage.usuario = resposta[0].nome;
                                    window.location.href = '../Dashboard/index.html';

                                })
                            } else {
                                Toast.fire({
                                    type: 'error',
                                    title: 'Por favor insira um e-mail válida!'
                                }).then(function () {
                                    console.log(JSON.stringify(resposta));
                                    sessionStorage.id = resposta[0].id;
                                    sessionStorage.usuario = resposta[0].nome;

                                })
                            }
                        }
                    });
                } else {

                    Swal.fire('Erro no login', 'Tente novamente', 'error');
                }
            });

            return false;
        }
    }
</script>